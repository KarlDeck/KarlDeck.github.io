<!DOCTYPE html>
<html>
<head>
    <title>Project 1</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        img {
            max-width: 400px; /* keep images reasonable size */
            margin: 10px;
            display: block;
        }
    </style>
</head>
<body>
    <h1>Project 1</h1>
    <h1>A: This is the naiive variant, with no finetuning and just a quick pyramid search:</h1>
    You can see that the photos are not cropped and also the color is not adjusted. Scroll down to see it with bells and whistles.


    <style>
        .gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        grid-gap: 10px;
        }
        .gallery img {
        width: 100%;
        height: auto;
        border-radius: 5px;
        object-fit: cover;
        transition: transform 0.2s;
        }
        .gallery img:hover {
        transform: scale(1.05);
        }
    </style>

    <h2>Photo Gallery (The last three are my personal picks from the archive)</h2>

    <div class="gallery">
        <img src="first/cathedral.jpg" alt="cathedral">
        <img src="first/church.jpg" alt="church">
        <img src="first/emir.jpg" alt="emir">
        <img src="first/harvesters.jpg" alt="harvesters">
        <img src="first/icon.jpg" alt="icon">
        <img src="first/italil.jpg" alt="italil">
        <img src="first/lastochikino.jpg" alt="lastochikino">
        <img src="first/lugano.jpg" alt="lugano">
        <img src="first/melons.jpg" alt="melons">
        <img src="first/monastery.jpg" alt="monastery">
        <img src="first/self_portrait.jpg" alt="self portrait">
        <img src="first/siren.jpg" alt="siren">
        <img src="first/three_generations.jpg" alt="three generations">
        <img src="first/tobolsk.jpg" alt="tobolsk">
        <img src="first/extra1.jpg" alt="extra_picture">
        <img src="first/extra2.jpg" alt="extra_picture">
        <img src="first/extra3.jpg" alt="extra_picture">
    </div>
    </body>
    </html>

It can be observed, that while the pictures almost align and the colours seem to add up to a intuitive mixture, forming well known color palets and a detectible subject, the quality is still not perfect and we can observe a lot of artefacts and color issues. The pictures are still in their original shape and the borders are clearly visible. These images were generated by first aligning the channels with the NCC similarity metric using a pyramid approach and then fusing the correctly aligned channels
<br>
Here is my shifts:
<pre>
Image: monastery Shift_G: [-6.  0.] Shift_R: [9. 1.]
Image: tobolsk Shift_G: [3. 2.] Shift_R: [6. 3.]
Image: cathedral Shift_G: [ 1. -1.] Shift_R: [ 7. -1.]
Image: emir Shift_G: [-3.  7.] Shift_R: [93. 17.]
Image: italil Shift_G: [38. 18.] Shift_R: [78. 34.]
Image: church Shift_G: [ 0. -5.] Shift_R: [52. -6.]
Image: three_generations Shift_G: [52.  5.] Shift_R: [93.  5.]
Image: lugano Shift_G: [  3. -10.] Shift_R: [ 81. -21.]
Image: melons Shift_G: [83.  4.] Shift_R: [93. -7.]
Image: lastochikino Shift_G: [-4. -2.] Shift_R: [59. -5.]
Image: icon Shift_G: [42. 16.] Shift_R: [89. 22.]
Image: siren Shift_G: [48. -7.] Shift_R: [ 93. -21.]
Image: self_portrait Shift_G: [50. -2.] Shift_R: [93. -5.]
Image: harvesters Shift_G: [59. 10.] Shift_R: [93. -1.]
Image: master-pnp-prok-00100-00106a Shift_G: [36. -6.] Shift_R: [ 89. -12.]
Image: master-pnp-prok-00100-00176a Shift_G: [75. 19.] Shift_R: [93. 11.]
Image: master-pnp-prok-00000-00093a Shift_G: [18. -7.] Shift_R: [ 57. -15.]
</pre>

<h1>B: This is the variant using edge detection for alignment, a color channel scaling and color correction for better quality:</h1>

    The steps taken are explained in more detail below. but lets just share the results first.

    <h2>Photo Gallery</h2>

    <div class="gallery">
        <img src="second/cathedral.jpg" alt="cathedral">
        <img src="second/church.jpg" alt="church">
        <img src="second/emir.jpg" alt="emir">
        <img src="second/harvesters.jpg" alt="harvesters">
        <img src="second/icon.jpg" alt="icon">
        <img src="second/italil.jpg" alt="italil">
        <img src="second/lastochikino.jpg" alt="lastochikino">
        <img src="second/lugano.jpg" alt="lugano">
        <img src="second/melons.jpg" alt="melons">
        <img src="second/monastery.jpg" alt="monastery">
        <img src="second/self_portrait.jpg" alt="self portrait">
        <img src="second/siren.jpg" alt="siren">
        <img src="second/three_generations.jpg" alt="three generations">
        <img src="second/tobolsk.jpg" alt="tobolsk">
        <img src="second/extra1.jpg" alt="extra_picture">
        <img src="second/extra2.jpg" alt="extra_picture">
        <img src="second/extra3.jpg" alt="extra_picture">
    </div>

    This version is percievably better than the first naiive try. The first step is to normalize the values for each chanel. For this it is assumed that the lowest value in each channel should be 0 and the highest 255. A MinMax scaler is used to approptiately project our values into this space. To align the channels this time i use edge detection. For this the channals are first blurred with gaussians to get rid of noise. Edges are being detected with canny. The next step is to try to align these edges, Pyramids are used to speed this action up again. In the next step the picture is cropped by detecting the black frame around the picture and cutting off the edges accordingly. In the next step i try to estimte the illuminance of the picture to correct the lighting. For this i use only inner pixels and not the pixels from the border, since these are contaminated by a lot of monochromatic artifacts. I then take this mean lighting and correct the images entire lighting with this, since we know that idiealy these colours should be balanced. This means the ideal average pixel is gray. Lastly I need to apply a colour mask to correct for the plates Prokudin-Gorskii used not being standardized to our modern day RGB standard. So his pure red was just not the same as ours. I tried to aproximate this with a matrix to transform between the colour spaces. I just used a little trial and error for this and tried to make it look realisitically.
<br>
Here is my shifts:
<pre>
Estimated illuminant: [0.6204749 0.7025412 0.7805039]
Image: monastery Shift_G: [-3  2] Shift_R: [3 2]
Estimated illuminant: [0.5515292 0.6791069 0.6897751]
Image: tobolsk Shift_G: [3 3] Shift_R: [6 3]
Estimated illuminant: [0.5652745 0.5087983 0.3935837]
Image: cathedral Shift_G: [5 2] Shift_R: [12  3]
Estimated illuminant: [0.5621013  0.48099372 0.5243955 ]
Image: emir Shift_G: [49 23] Shift_R: [107  40]
Estimated illuminant: [0.6040247  0.65084964 0.58535725]
Image: italil Shift_G: [40 22] Shift_R: [77 36]
Estimated illuminant: [0.5204202  0.53794163 0.6813928 ]
Image: church Shift_G: [25  4] Shift_R: [58 -4]
Estimated illuminant: [0.5573972 0.5020272 0.5784608]
Image: three_generations Shift_G: [56 11] Shift_R: [111   7]
Estimated illuminant: [0.5149177  0.6559273  0.69885457]
Image: lugano Shift_G: [ 41 -15] Shift_R: [ 92 -29]
Estimated illuminant: [0.6270275  0.55221456 0.47117198]
Image: melons Shift_G: [80 10] Shift_R: [182  11]
Estimated illuminant: [0.5251243  0.56698406 0.40855905]
Image: lastochikino Shift_G: [-3 -2] Shift_R: [75 -8]
Estimated illuminant: [0.5934841  0.55975723 0.38603964]
Image: icon Shift_G: [38 19] Shift_R: [88 22]
Estimated illuminant: [0.40155703 0.45411754 0.6251505 ]
Image: siren Shift_G: [48 -8] Shift_R: [ 96 -23]
Estimated illuminant: [0.53835636 0.5580919  0.47626042]
Image: self_portrait Shift_G: [77 29] Shift_R: [175  37]
Estimated illuminant: [0.6818688  0.6391872  0.47170338]
Image: harvesters Shift_G: [60 18] Shift_R: [117  10]

</pre>

</body>
</html>
